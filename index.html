<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KJD7BHMQ');</script>
    <!-- End Google Tag Manager -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Purchase Platform</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script>
        if (window.location.hostname !== '127.0.0.1') {
            // Dynamic script injection for production only
            // console.log('Production');
            const script = document.createElement('script');
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-W9ME8WWC9C';
            script.async = true;
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-W9ME8WWC9C');
        } else {
            console.log('Development');
        }
    </script>
    <style>
        .brochure-card {
            transition: all 0.3s ease;
            width: 300px;
            height: 470px;
        }
        .brochure-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .grade-tabs-container {
            overflow-x: auto;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .grade-tabs-container::-webkit-scrollbar {
            display: none;
        }
        .grade-tab {
            flex-shrink: 0;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 9999px;
            transition: all 0.3s ease;
            cursor: pointer;
            white-space: nowrap;
        }
        .grade-tab.active {
            background-color: #3B82F6;
            color: white;
        }
        .grade-tab:not(.active) {
            background-color: #E5E7EB;
            color: #4B5563;
        }
        .grade-tab:hover:not(.active) {
            background-color: #F3F4F6;
        }
        .animate-slide-in {
            /* animation: slideIn 0.3s ease forwards; */
        }
        .error-input {
            border-color: red;
        }
        .grade-tab {
            transition: all 0.3s ease;
        }
        .grade-tab.active {
            background-color: #3B82F6;
            color: white;
        }

        .custom-orange-btn {
            border: 2px solid #f97316; /* Orange color */
            color: #f97316; /* Orange text */
            padding: 0.5rem 1.5rem;
            border-radius: 9999px; /* Fully rounded */
            background-color: transparent;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        .custom-orange-btn:hover {
            background-color: #ffedd5; /* Light orange */
        }

        #toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            width: 400px;
            display: none;
        }
                
        .toast {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: rgba(33, 33, 33, 0.95);
            color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            #toast-container {
                top: 80px;
                right: 10px;
                width: 300px;
            }

            .toast {
                padding: 10px 12px;
            }

            .toast .message {
                font-size: 0.75rem;
                line-height: 1.2;
            }
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .toast .message {
            font-size: 0.95rem;
            line-height: 1.4;
            margin-right: 8px;
            flex: 1;
            font-weight: 500;
        }

        .flag {
            display: flex;
            flex-direction: column;
            width: 60px;
            height: 40px;
            margin-right: 15px;
            border: 1px solid #fff;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .saffron {
            background: #ff9933;
            height: 33%;
        }
        
        .white {
            background: #ffffff;
            height: 33%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .ashoka-chakra {
            width: 10px; /* Wheel size */
            height: 10px;
            border: 1px solid #000088;
            border-radius: 50%;
            background: transparent;
            position: relative;
        }
        
        .ashoka-chakra::before,
        .ashoka-chakra::after {
            content: '';
            position: absolute;
            width: 1px; /* Spoke thickness */
            height: 50%; /* Spoke length */
            background: #000088;
            top: 0;
            left: 50%;
            transform-origin: bottom;
            transform: translateX(-50%);
        }
        
        /* Add 4 additional spokes */
        .ashoka-chakra .spoke {
            position: absolute;
            width: 1px; /* Spoke thickness */
            height: 50%; /* Spoke length */
            background: #000088;
            top: 0;
            left: 50%;
            transform-origin: bottom;
        }
        
        /* Rotations for the spokes */
        .ashoka-chakra .spoke:nth-child(1) { transform: translateX(-50%) rotate(0deg); }
        .ashoka-chakra .spoke:nth-child(2) { transform: translateX(-50%) rotate(60deg); }
        .ashoka-chakra .spoke:nth-child(3) { transform: translateX(-50%) rotate(120deg); }
        .ashoka-chakra .spoke:nth-child(4) { transform: translateX(-50%) rotate(180deg); }
        .ashoka-chakra .spoke:nth-child(5) { transform: translateX(-50%) rotate(240deg); }
        .ashoka-chakra .spoke:nth-child(6) { transform: translateX(-50%) rotate(300deg); }
        
        .green {
            background: #138808;
            height: 33%;
        }
        
        .message {
            font-size: 18px;
            font-weight: bold;
            word-wrap: break-word; /* Allow breaking long words */
            overflow: hidden;      /* Prevent overflow issues */
            max-width: 200px;      /* Set a maximum width for better readability */
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background-color: #007bff;
            width: 100%;
            animation: progressBar 5s linear;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            to { transform: translateX(100%); opacity: 0; }
        }
        @keyframes progressBar {
            from { width: 100%; }
            to { width: 0%; }
        }

        /* Stream tabs styling */
        #stream-tabs {
            animation: fadeIn 0.3s ease-in-out;
            margin-top: -4px; /* Move it slightly closer to the grade tabs */
        }
        #stream-tabs .grade-tab {
            background-color: white;
            font-size: 0.85rem; /* Slightly smaller font */
            padding: 5px 12px; /* Slightly smaller padding */
            line-height: 1.2;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        #stream-tabs .grade-tab.active {
            background-color: #3B82F6;
            color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        #stream-tabs .grade-tab:not(.active) {
            background-color: #E5E7EB;
            color: #4B5563;
        }
        #stream-tabs .grade-tab:hover:not(.active) {
            background-color: #F3F4F6;
        }
        #stream-filters-container {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KJD7BHMQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <img src="assets/image.png" alt="Eduport" class="h-10 mr-4">
                    <h1 class="text-xl font-bold text-gray-800 hidden md:block">Course Platform</h1>
            </div>
            <div class="text-gray-700 font-medium">
                <a href="tel:+919048899553" class="flex items-center">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 3H8a2 2 0 00-2 2v14a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 3L12 7 8 3"/>
                        </svg>
                        +91 90488 99553
                    </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12 animate-slide-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Available Courses</h2>
            <p class="text-gray-600">Explore and purchase our courses</p>
        </header>

        <div id="toast-container" class="toast-container hidden">
            <div class="toast">
                <div class="flag">
                    <div class="saffron"></div>
                    <div class="white">
                        <div class="ashoka-chakra">
                            <div class="spoke"></div>
                            <div class="spoke"></div>
                            <div class="spoke"></div>
                            <div class="spoke"></div>
                            <div class="spoke"></div>
                            <div class="spoke"></div>
                        </div>
                    </div>
                    <div class="green"></div>
                </div>
                <div class="message"></div>
                <div class="toast-progress"></div>
            </div>
        </div>

        <div id="grade-tabs" class="flex justify-start space-x-4 mb-2 overflow-x-auto">
            <button onclick="filterCoursesByGrade('all')" class="grade-tab px-4 py-2 bg-blue-500 text-white rounded-lg active" data-grade="all">
                All
            </button>
        </div>

        <!-- Stream filter tabs - Initially hidden -->
        <div id="stream-filters-container" class="hidden">
            <div class="text-xs text-gray-500 mb-1 ml-1">Filter by stream/medium:</div>
            <div id="stream-tabs" class="flex justify-start space-x-3 mb-6 overflow-x-auto">
                <!-- Stream tabs will be dynamically populated based on selected grade -->
            </div>
        </div>

        <div id="courses-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 place-items-center justify-center">
            <div class="col-span-full text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="mt-4 text-gray-600">Loading courses...</p>
            </div>
        </div>
    </div>

    <div id="purchase-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg w-11/12 max-w-md relative p-6">
            <button onclick="closePurchaseModal()" class="absolute right-4 top-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <h2 class="text-2xl font-bold mb-6">Purchase Course</h2>
            <form id="purchase-form" novalidate>
                <input type="text" name="name" placeholder="Full Name" class="w-full mb-4 p-2 border rounded" required>
                <div id="name-error" class="text-red-500 text-sm mb-2 hidden">Please enter full name</div>
                <input type="email" name="email" placeholder="Email Address" class="w-full mb-4 p-2 border rounded" required>
                <div id="email-error" class="text-red-500 text-sm mb-2 hidden">Please enter a valid email address</div>
                <input type="tel" name="phone" placeholder="Registered Mobile Number" class="w-full mb-4 p-2 border rounded" required>
                <div id="phone-error" class="text-red-500 text-sm mb-2 hidden">Please enter a valid 10-digit mobile number</div>
                <input type="tel" name="alt-phone" placeholder="Alternative Mobile Number" class="w-full mb-4 p-2 border rounded">
                <input type="hidden" name="course-id" id="selected-course-id">
                <input type="hidden" name="course-amount" id="selected-course-amount">
                <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                    Proceed to Pay
                </button>
            </form>
        </div>
    </div>

    <div id="payment-confirmation" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg w-11/12 max-w-md p-6 text-center">
        
        <!-- Animation container -->
        <div id="animation-container" class="mb-4"></div>
    
        <!-- Status text -->
        <p id="payment-status"></p>
    
        <p id="payment-status" class="mb-4"></p>

        <div class="mb-6">
            <img src="assets/freedom.png" class="w-48 mx-auto" alt="QR Code" />
        </div>
        
        <!-- QR Code -->
        <div class="mb-6">
            <img src="assets/download_qr.png" class="w-96 mx-auto" alt="QR Code" />
        </div>

        <div class="flex justify-center mb-4">
            <a href="https://apps.apple.com/in/app/eduport-sslc-11-12-science/id6443499408" target="_blank" class="mr-4">
                <img src="assets/app_store.svg" alt="Download on the App Store" />
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.irah.eduportlms&hl=en_IN&gl=US&pli=1" target="_blank" class="mr-4">
                <img src="assets/play_store.svg" alt="Download on the App Store" />
            </a>
            <a href="https://web.eduport.app/" target="_blank">
                <img src="assets/web.svg" alt="Only For Desktop Access On Web" />
            </a>
        </div>
        <button id="close-confirmation" class="custom-orange-btn">Close</button>
    </div>
</div>

    <script>
        const API_URL = 'https://raw.githubusercontent.com/eduport-tech/course-purchase/refs/heads/main/data/res.json';
        // const API_URL = 'data/res.json';
        let allCourses = [];

        // Route handling
        function handleRouting() {
            // Reset initial values
            window.initialGrade = 'all';
            window.initialStream = 'all';
            
            // Get the hash from the URL (without the # symbol)
            const hash = window.location.hash.substring(1);
            
            if (!hash) return; // No hash, use default values
            
            // Check for grade in hash
            const gradeMatch = hash.match(/class\/(\w+)/);
            const streamMatch = hash.match(/stream\/([^\/]+)/);
            
            if (gradeMatch && gradeMatch[1]) {
                const grade = gradeMatch[1];
                window.initialGrade = grade;
                document.title = `Class ${grade} Courses | Course Purchase Platform`;
                
                // Check for stream parameter
                if (streamMatch && streamMatch[1]) {
                    const streamValue = decodeURIComponent(streamMatch[1]);
                    window.initialStream = streamValue;
                    document.title = `Class ${grade} - ${streamValue} Courses | Course Purchase Platform`;
                }
            }
            
            // console.log(`Routing: Grade=${window.initialGrade}, Stream=${window.initialStream}`);
        }

        // Update URL without page reload
        function updateURL(grade, stream) {
            // Format the URL and title based on filters
            let newHash = '';
            let newTitle = '';
            
            if (grade === 'all') {
                newTitle = 'All Courses | Course Purchase Platform';
                newHash = ''; 
            } else {
                if (stream && stream !== 'all') {
                    newTitle = `Class ${grade} - ${stream} Courses | Course Purchase Platform`;
                    newHash = `class/${grade}/stream/${encodeURIComponent(stream)}`;
                } else {
                    newTitle = `Class ${grade} Courses | Course Purchase Platform`;
                    newHash = `class/${grade}`;
                }
            }
            
            // Update the document title
            document.title = newTitle;
            
            // Update URL hash immediately, ensuring we don't trigger a page reload
            if (window.location.hash !== `#${newHash}`) {
                // Temporarily remove the hashchange listener to prevent recursion
                window.removeEventListener('hashchange', handleHashChange);
                
                // Update the hash
                window.location.hash = newHash;
                
                // Re-add the listener after a short delay
                setTimeout(() => {
                    window.addEventListener('hashchange', handleHashChange);
                }, 10);
            }
        }

        // Extract the hashchange handling to a separate function
        function handleHashChange() {
            // Get previous values before routing
            const prevGrade = window.initialGrade;
            const prevStream = window.initialStream;
            
            // Update routing values
            handleRouting();
            
            if (allCourses.length) {
                // Check if grade has changed
                const gradeChanged = prevGrade !== window.initialGrade;
                
                // Apply grade filter first
                filterCoursesByGrade(window.initialGrade);
                
                // Apply stream filter if exists (and is not 'all')
                // AND only if grade hasn't changed or we came from a URL with stream param
                if (window.initialStream && window.initialStream !== 'all' && !gradeChanged) {
                    // Check if the stream actually exists in the current grade
                    const currentGradeCourses = allCourses.filter(course => 
                        window.initialGrade === 'all' || course.Grade === window.initialGrade);
                    
                    const streamExists = currentGradeCourses.some(course => 
                        course.Stream === window.initialStream);
                    
                    if (streamExists) {
                        setTimeout(() => {
                            filterCoursesByStream(window.initialStream);
                        }, 100); // Small delay to ensure grade filter is applied first
                    } else {
                        // console.log(`Stream '${window.initialStream}' not found in grade ${window.initialGrade}`);
                        // Reset to 'all' streams if specified stream doesn't exist
                        window.initialStream = 'all';
                        updateURL(window.initialGrade, 'all');
                    }
                }
            }
        }

        // Handle browser hash changes
        window.addEventListener('hashchange', handleHashChange);

        // Initialize routing on page load
        handleRouting();

        // Add device detection function
        function detectDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            if (/android/i.test(userAgent)) {
                return 'android';
            } else if (/iphone|ipad|ipod/i.test(userAgent)) {
                return 'ios';
            }
            return 'web';
        }

        // Add app store URLs
        const APP_URLS = {
            android: 'https://play.google.com/store/apps/details?id=com.irah.eduportlms&hl=en_IN&gl=US&pli=1',
            ios: 'https://apps.apple.com/in/app/eduport-sslc-11-12-science/id6443499408'
        };

        function getGoogleDriveThumbnail(fileId) {
            return `https://lh3.googleusercontent.com/d/${fileId}=w400-h300-p-k-nu`;
        }

        async function fetchCourses() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                allCourses = data.results;
                renderCourses(allCourses);
                createGradeTabs(allCourses);
                
                // Apply initial grade filter if set by route
                if (window.initialGrade && window.initialGrade !== 'all') {
                    // Set current stream for URL-based navigation
                    if (window.initialStream && window.initialStream !== 'all') {
                        window.currentStream = window.initialStream;
                    }
                    
                    // Apply grade filter (this will create stream tabs too)
                    filterCoursesByGrade(window.initialGrade);
                    
                    // Apply stream filter if exists after a short delay
                    // and ONLY if it came from the URL (window.initialStream)
                    if (window.initialStream && window.initialStream !== 'all') {
                        setTimeout(() => {
                            filterCoursesByStream(window.initialStream);
                        }, 100); // Small delay to ensure grade filter is applied first
                    }
                }

                // Start toast notifications after courses are loaded
                // setInterval(showToast, 60*1000);
            } catch (error) {
                console.error('Error fetching courses:', error);
                document.getElementById('courses-container').innerHTML =
                    '<div class="col-span-full text-center text-red-500">Failed to load courses. Please try again later.</div>';
            }
        }

        function createGradeTabs(courses) {
            const gradeTabs = document.getElementById('grade-tabs');
            gradeTabs.classList.add('grade-tabs-container');
            
            // Get unique grades
            const uniqueGrades = ['all', ...new Set(courses.map(course => course.Grade))];
            
            // Create tabs dynamically
            const gradesHTML = uniqueGrades.map(grade => `
                <button 
                    onclick="filterCoursesByGrade('${grade}')" 
                    class="grade-tab ${grade === window.initialGrade ? 'active' : ''}" 
                    data-grade="${grade}"
                >
                    ${grade === 'all' ? 'All Classes' : `Class ${grade}`}
                </button>
            `).join('');
            
            gradeTabs.innerHTML = gradesHTML;
            
            // Add click event listener to handle tab activation
            gradeTabs.addEventListener('click', function(event) {
                const clickedTab = event.target.closest('.grade-tab');
                if (clickedTab) {
                    // Remove active class from all tabs
                    this.querySelectorAll('.grade-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab
                    clickedTab.classList.add('active');
                }
            });
        }

        // Create stream tabs based on the selected grade
        function createStreamTabs(grade) {
            const streamContainer = document.getElementById('stream-filters-container');
            const streamTabs = document.getElementById('stream-tabs');
            streamTabs.classList.add('grade-tabs-container'); // Reuse the same style
            
            // If 'all' is selected, hide the stream tabs
            if (grade === 'all') {
                streamContainer.classList.add('hidden');
                return;
            }
            
            // Get courses for the selected grade
            const filteredCourses = allCourses.filter(course => course.Grade === grade);
            
            // Get unique non-null streams from filtered courses
            const uniqueStreamValues = [...new Set(filteredCourses.map(course => course.Stream).filter(Boolean))];
            
            // Only show stream tabs if there's at least one non-null stream value
            if (uniqueStreamValues.length === 0) {
                streamContainer.classList.add('hidden');
                return;
            }
            
            // Add 'all' as the first option
            const uniqueStreams = ['all', ...uniqueStreamValues];
            
            // For a grade change, we want to force 'all' as the active stream
            // window.currentStream should already be 'all' when coming from filterCoursesByGrade
            const activeStream = 'all';
            
            // Create tabs dynamically
            const streamsHTML = uniqueStreams.map(stream => {
                const isActive = stream === activeStream;
                return `
                <button 
                    class="grade-tab ${isActive ? 'active' : ''}" 
                    data-stream="${stream}"
                >
                    ${stream === 'all' ? 'All' : stream}
                </button>
            `}).join('');
            
            streamTabs.innerHTML = streamsHTML;
            streamContainer.classList.remove('hidden');
            
            // Add click event listener to handle tab activation
            streamTabs.querySelectorAll('.grade-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Get the stream value from data attribute
                    const streamValue = this.getAttribute('data-stream');
                    
                    // Call filterCoursesByStream with the stream value
                    filterCoursesByStream(streamValue);
                });
            });
        }

        function filterCoursesByGrade(grade) {
            // Update grade tabs
            const tabs = document.querySelectorAll('.grade-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active', 'bg-blue-500', 'text-white');
                tab.classList.add('bg-gray-200');
            });

            const selectedTab = document.querySelector(`[data-grade="${grade}"]`);
            if (selectedTab) {
                selectedTab.classList.add('active', 'bg-blue-500', 'text-white');
            }

            // Update navigation links appearance
            document.querySelectorAll('[data-nav-grade]').forEach(link => {
                if (link.getAttribute('data-nav-grade') === grade) {
                    link.classList.add('bg-blue-500', 'text-white');
                    link.classList.remove('hover:bg-gray-100', 'text-gray-800');
                } else {
                    link.classList.remove('bg-blue-500', 'text-white');
                    link.classList.add('hover:bg-gray-100', 'text-gray-800');
                }
            });

            const filteredCourses = grade === 'all'
                ? allCourses
                : allCourses.filter(course => course.Grade === grade);

            // Reset current stream filter - IMPORTANT when changing grades
            window.currentStream = 'all';
            
            // Create stream tabs for this grade (will respect window.currentStream = 'all')
            createStreamTabs(grade);
        
            // Update URL with just the grade (no stream)
            updateURL(grade, 'all');            
            renderCourses(filteredCourses);
        }

        // Filter courses by stream (after grade is selected)
        function filterCoursesByStream(stream) {
            // Store the current stream
            window.currentStream = stream;
            
            // Update stream tabs styling
            const streamTabs = document.querySelectorAll('#stream-tabs .grade-tab');
            streamTabs.forEach(tab => {
                // Remove all styling classes
                tab.classList.remove('active', 'bg-blue-500', 'text-white');
                // Add default styling
                if (tab.getAttribute('data-stream') === stream) {
                    // Add active styling
                    tab.classList.add('active');
                }
            });

            // Get the current grade filter
            const activeGradeTab = document.querySelector('#grade-tabs .grade-tab.active');
            const currentGrade = activeGradeTab ? activeGradeTab.getAttribute('data-grade') : 'all';
            
            // First filter by grade
            let filteredCourses = currentGrade === 'all' 
                ? allCourses 
                : allCourses.filter(course => course.Grade === currentGrade);
            
            // Then filter by stream if not 'all'
            if (stream !== 'all') {
                filteredCourses = filteredCourses.filter(course => course.Stream === stream);
            } else {
                // When 'all' is selected, include courses with null/undefined streams too
                // This is already handled since we're not filtering by stream at all
            }
            
            // Update URL with both grade and stream
            updateURL(currentGrade, stream);
            
            renderCourses(filteredCourses);
        }

        function renderCourses(courses) {
            const coursesContainer = document.getElementById('courses-container');
            const device = detectDevice();
            
            coursesContainer.innerHTML = courses.map((course, index) => {
                const fileId = course['Course Image'].match(/\/d\/(.*?)\/view/)?.[1];
                const thumbnailUrl = fileId ? getGoogleDriveThumbnail(fileId) : null;

                const originalPrice = parseInt(course['Batch Amount']);
                const discountedPrice = parseInt(course['Discounted Amount']) ? course['Discounted Amount'] : originalPrice > 0 ? Math.floor(originalPrice / 2) : 0;
                
                const isFree = originalPrice === 0;
                let buttonHtml = '';
                
                if (isFree) {
                    if (device === 'web') {
                        buttonHtml = `<button onclick="openPurchaseModal('${course['Batch ID']}', 0)" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            Download App
                        </button>`;
                    } else {
                        const appUrl = APP_URLS[device];
                        buttonHtml = `<a href="${appUrl}" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-center block">
                            Download App
                        </a>`;
                    }
                } else {
                    buttonHtml = `<button onclick="openPurchaseModal('${course['Batch ID']}', ${discountedPrice})" 
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        Purchase Now
                    </button>`;
                }

                return `
                <div class="brochure-card bg-white rounded-xl overflow-hidden shadow-lg animate-slide-in" style="animation-delay: ${index * 100}ms">
                    <div class="h-56 w-full overflow-hidden">
                        <img 
                            src="${thumbnailUrl || course['Course Image']}" 
                            alt="${course['Course Name']}" 
                            class="w-full object-contain" 
                        >
                    </div>
                    <div class="flex flex-col justify-around p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">${course['Course Name']}</h3>
                        <div class="mb-2">
                            <span class="bg-blue-100 mr-2 my-2 text-blue-800 text-xs px-2 py-1 rounded-full">Batch: ${course['Batch ID']} </span>
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Class ${course.Grade}</span>
                        </div>
                        <div class="flex items-center mb-4">
                            ${originalPrice > 0 ? `
                            <p class="text-sm text-gray-500 line-through mr-3">‚Çπ${originalPrice}</p>
                            <p class="text-lg font-bold text-green-600">‚Çπ${discountedPrice}</p>
                            ` : `
                            <p class="text-lg font-bold text-green-600">Free</p>
                            `}
                        </div>
                        ${buttonHtml}
                    </div>
                </div>`;
            }).join('');
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }

        function validatePhone(phone) {
            const re = /^[6-9]\d{9}$/;
            return re.test(phone);
        }

        function openPurchaseModal(courseId, courseAmount) {
            document.getElementById('selected-course-id').value = courseId;
            document.getElementById('selected-course-amount').value = courseAmount;
            
            // Get course name from the displayed courses
            const courseName = document.querySelector(`[onclick="openPurchaseModal('${courseId}', ${courseAmount})"]`)
                .closest('.brochure-card')
                .querySelector('h3').textContent;

            if (courseAmount > 0) {
                document.getElementById('purchase-modal').classList.remove('hidden');
            } else {
                document.getElementById('payment-confirmation').classList.remove('hidden');
            }
        }

        function closePurchaseModal() {
            document.getElementById('purchase-modal').classList.add('hidden');
        }

        document.getElementById('purchase-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const email = formData.get('email');
            const phone = formData.get('phone');
            const name = formData.get('name');
            const courseId = formData.get('course-id');
            const courseAmount = formData.get('course-amount');

            const emailError = document.getElementById('email-error');
            const nameError = document.getElementById('name-error');
            const phoneError = document.getElementById('phone-error');
            const emailInput = document.querySelector('input[name="email"]');
            const phoneInput = document.querySelector('input[name="phone"]');
            const nameInput = document.querySelector('input[name="name"]');

            let isValid = true;

            emailError.classList.add('hidden');
            phoneError.classList.add('hidden');
            emailInput.classList.remove('error-input');
            phoneInput.classList.remove('error-input');
            nameError.classList.add('hidden');

            if (!name) {
                nameError.classList.remove('hidden');
                nameInput.classList.add('error-input');
                isValid = false;
            }

            if (!validateEmail(email)) {
                emailError.classList.remove('hidden');
                emailInput.classList.add('error-input');
                isValid = false;
            }

            if (!validatePhone(phone)) {
                phoneError.classList.remove('hidden');
                phoneInput.classList.add('error-input');
                isValid = false;
            }

            if (!isValid) return;

            // Get course name from the displayed courses
            const courseName = document.querySelector(`[onclick="openPurchaseModal('${courseId}', ${courseAmount})"]`)
                .closest('.brochure-card')
                .querySelector('h3').textContent;

            // Push checkout initiated event to dataLayer with user details
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'checkout_initiated',
                'course_id': courseId,
                'course_name': courseName,
                'amount': courseAmount,
                'user_name': name,
                'user_email': email,
                'user_phone': phone
            });

            var options = {
                key: "rzp_live_0UgwbbPoWnTHWE",
                amount: courseAmount * 100,
                currency: "INR",
                name: "Your Course Platform",
                description: `Course Purchase: Batch ${courseId}`,
                handler: function (response) {
                    showPaymentConfirmation(true, response.razorpay_payment_id, {
                        name: name,
                        email: email,
                        phone: phone,
                        courseId: courseId,
                        courseName: courseName,
                        amount: courseAmount
                    });
                },
                prefill: {
                    name: name,
                    email: email,
                    contact: phone
                },
                notes: {
                    name: name,
                    email: email,
                    contact: phone,
                    batch: courseId
                },
                theme: {
                    color: "#3399cc"
                }
            };

            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response) {
                showPaymentConfirmation(false, null);
            });
            rzp1.open();

            closePurchaseModal();
        });

        function showPaymentConfirmation(success, paymentId, userDetails) {
            const confirmationModal = document.getElementById('payment-confirmation');
            const statusText = document.getElementById('payment-status');
            const animationContainer = document.getElementById('animation-container');

            confirmationModal.classList.remove('hidden');

            // Reset the content of the animation container
            animationContainer.innerHTML = ''; // Clear previous animation

            // Reset any previous styles
            statusText.className = 'text-2xl font-bold mb-6';

            if (success) {
                // Push purchase success event to dataLayer with user details
                window.dataLayer = window.dataLayer || [];
                window.dataLayer.push({
                    'event': 'purchase_successful',
                    'course_id': userDetails.courseId,
                    'course_name': userDetails.courseName,
                    'amount': userDetails.amount,
                    'transaction_id': paymentId,
                    'user_name': userDetails.name,
                    'user_email': userDetails.email,
                    'user_phone': userDetails.phone
                });

                // Set success message and styles
                statusText.textContent = 'Payment Successful!';
                statusText.classList.add('text-green-500');

                // Add success animation
                animationContainer.innerHTML = `
                    <lottie-player
                        src="assets/success_lottie.json"
                        background="transparent"
                        speed="1"
                        style="width: 80px; height: 80px; margin: 0 auto;"
                        autoplay>
                    </lottie-player>
                `;
            } else {
                // Set failure message and styles
                statusText.textContent = 'Payment Failed!';
                statusText.classList.add('text-red-500');

                // Add failure animation
                animationContainer.innerHTML = `
                    <lottie-player
                        src="assets/fail_lottie.json"
                        background="transparent"
                        speed="1"
                        style="width: 80px; height: 80px; margin: 0 auto;"
                        autoplay>
                    </lottie-player>
                `;
            }

            document.getElementById('close-confirmation').onclick = () => {
                confirmationModal.classList.add('hidden');
            };
        }

        function splitMessage(message, maxLength) {
            let result = [];
            while (message.length > maxLength) {
                let breakPoint = message.lastIndexOf(" ", maxLength);
                if (breakPoint === -1) breakPoint = maxLength;
                result.push(message.substring(0, breakPoint));
                message = message.substring(breakPoint).trim();
            }
            result.push(message);
            return result.join("<br>"); 
        }

        let isToastVisible = false; // Track toast visibility to prevent message change during display

        function showToast() {
            
            var names = ['Navya A', 'aparna. a', 'Midhila M Remesh', 'Twdz', 'MUHAMMAD DILSHAD M', 'aysha mehrin', 'Shehinsha.T', 'Fathima jumna tk', 'Abhirami VA', 'mishaal musthafa', 'Munavvir vk', 'sandra c c', 'Muhammed Sahal.K', 'libiya mil mathew', 'SAHLA', 'Rajeena PT Shoukath', 'muhd thanseeh', 'anamika. r', 'Binsha Sherin', 'Aslam TM', 'Diyana hassan c', 'emil s thomas', 'stefin sanoj', 'mudhasir', 'Velu.k', 'MUHAMMED MEHAFIL K', 'riya mariyam', 'riya parveen', 'i am__good girl', 'Ashlin Joseph', 'Nithun KN', 'Gokul Babu', 'Naseeba.v', 'pavithra Hari', 'Muhammad suhail A', 'ALLEN ANTONY', 'Shikha A S', 'muhammed najih. k', 'Emmanuvel Joseph benny', 'Thaejes Sinto', 'blaze s', 'Adithya AA', 'anurang ac', 'sajid m. s', 'Nasla Illabi', 'sana nazar', 'Merin Annie Thomas', 'simi 6', 'Ajmal Satheesh', 'Íú± Ä·¥á·¥á ú·¥Ä Ä…™ ·¥ã·¥ç', 'Muhammed shefin m.k', 'Gayathry', 'NANDANA SIVAPRASAD', 'Rayza Fathima ', 'ùô™ùôØùôñùôûùôß', 'Abdulla murthala ', 'sanjana TS', 'SALIM FARHAN', 'Nehala fathima', 'akshay vp', 'musaina thasni tp', 'Archana vineshan', 'Don Vincent', 'MOHAMMED NASRULLA ', 'Shazin Muhammed nk ', 'SREERAG T', 'Mohammed Faseen TP', 'Johan T John', 'sandra Krishnakumar ', 'Mishal K', 'Nivedya Krishna I R', 'Alok AKA akku', 'NISAMUDHEEN M.S', 'Angel Rose Sony', 'ARFIN BASHEER', 'farhan ummer cheranthodika', 'Hayagrevv nair', 'sandriya ', 'JERLIN JOSEPH', 'Diya Fathima YS', 'Shamil Rp', 'Archana. Vijayakumar', 'ùó°ùóîùóóùóúùóü ùó•ùóîùó¨ùóîùó°', 'nishil', 'vismaya.P', 'abhirami j', 'Sivanth E N', 'AJMAL SHAHAD-C', 'Rahda', 'shoukath', 'ABDUL RAHOOF. K', 'Samiya sinu', 'NAVANEETH.M.SAJU', 'Shahanas K. A', 'vysakh. H', 'Hrithika Rajesh mk', 'sappu...ü§ç', 'Amaya. N', 'Muhammed Alfas N', 'rudra. k', 'Muhammad Najah p', 'Aseel sherif', 'melsa Mariam kochumon', 'Aswan A', 'Fathima anshida', 'sangeeth gs', 'Rithul Acm', 'Archana. M. B', 'Fida. tk', 'Abdulla Hashim ', 'arinjooda', 'Sreekanth Sreekumar', 'devanjali M', 'Mohammed Nihal p', 'fathima rinsha tk', 'Bhagyalakshmi Sajeev', 'kansul hidayath', 'Rhaja fathima', 'zidin', 'Rubeena', 'Athulya Peethambaran', 'sayedmuhammedshanu. A', 'Nikhila Chikku', 'muhmd nashif', 'SHEBIN KURIAN', 'zaara', 'Adwaith. T', 'Labeeba Loolu', 'Fathimathul Aslaha', 'Fathima thasniya. n. p', 'Abai', 'Ardhra. k', 'Neelanjana K. N', 'Dajin Zayan', 'Don Joby', 'Gouri ', 'Alphonsa Aji', 'M.S Bravish Panicker', 'Arunima o. s', 'Anunandha A', 'Seema Lohar', 'bygjj', 'Abhinand v', 'Geethu. p', 'Mehaja', 'Amir Hasan', 'Athul krishna Ps', 'mukesh', 'juhaina jinu', 'Sooryajith Mahesh', 'Riya prekash', 'Ashwathi Elisabath', 'Fahmida vk', 'rjduei', 'krupa jose', 'Harish Harish', 'Fairooza', 'Arya. s', 'Mohammed Raseen kp', 'karna', 'Arya Ranjith', 'Fathima Nifa', 'Pranava PG', 'Alfred Vincent', 'muhammed Shaheem kv', 'Arunoday', 'Fathima Nishwa k.p', 'luthfa latheef', 'yosha', 'Rishad Kkv', 'Anshif Anshif', 'Gopika Gopuuzz', 'farshid', 'Kevin tom saji', 'Adisha', 'Mishal Cp', 'Manavv Vv', 'Neeraja Raveendran', 'Jilson Joseph', 'Anurag.M', 'fasila sidhik', 'Nandhana BR', 'Sarah A S', 'Rilwana. M', 'Karthik Jyothi', 'Anjana. s. m', 'Adel Maliyekkal', 'Ajay.p.rajesh', 'athul murali', 'Sabah', 'Rashida. kt', 'vishnu p s', 'prarthana.E', 'Syed Athikarath', 'akhil. a k', 'Harel Antony Olivero ', 'Hasna A', 'Bilal!! ikkaa', 'mohammed radhin KP', 'Anzila mol k.p', 'Remyajustin Justin', 'Nahla kk', 'Alameen Rahim', 'Sanulal K', 'miza fathima p. m', 'Fathima p p', 'sivani vinod', 'shemeera', 'Jiya Merin Jiji', 'Harikrishna  KB', 'bujqit', 'dilna khadeeja', 'suresh Valappil', 'fidha Fathima TP', 'Athul sankar. u', 'nafsil', 'Abel Xavier', 'Niya Rachel', 'FATHIMA DHIYANA', 'Padmashankar', 'Aloysious Sunny', 'reja fathima vm', 'VishnuDev', 'Swaliha Cs', 'nahina sahirana', 'riya fathima A', 'yazna', 'T B Abhishek', 'Yathil Bhandary', '814718', 'JOE PRAKASH', 'Rejo George', 'Amrutha-A', 'Aysha hamdha', 'Arjun.v', 'adish pk', 'Mohammed Rehaan', 'vishnu devan', 'Veena. S', 'Pranav E.S', 'Lakshmi Abhilash', 'Tejin CT ', 'Ashifa sherin', 'Muhammed Javad', 'sreerag dileep', 'f. salha ck', 'Sanketh VS', 'Sulthana  Fathima', 'Sreekala Sreejith', 'Mohammed shahil', 'Prarthana PG', 'Aiswarya.m', 'CHRISTO  THOMAS', 'fat', 'alna mohammed', 'Shifna Sherin C ', 'Fathimathu Ragda. m', 'Hyra Shafeeq', 'sanvi.r', 'shiby', 'Ayisha febin N.K', 'NIMISHA M 10A', 'P. S. Mohammed bilal ', 'Fathima Risli. M', 'Anima', 'Drishya Ammu', 'Athira Ramesh', 'rithika santhosh', 'BIJU D', 'Aneena KA', 'Sumayya sherin Ms', 'Sithara jebin mk', 'Ahal k.c', 'Siji Lukose', 'Varsha Chandrasekharan ', 'AHAMMED YAZEEN', 'Famiya F B', 'Hemaradha', 'Lisha Ram', 'Ann Maria Cherian', 'SREYA.P', 'Anas Hameed. M', 'Salim Abdul Rahiman', 'devanandana', 'ARJUN UP', 'velady', 'MHD RIFAD', 'Nayana Suresh ', 'Rasin', 'Ajinas Muhammed p', 'RAJITHA SANTHOSH', 'suhana kadher', 'md rumman alam', 'SATHEESH T', 'Fathima shaja. c', 'Sariga S', 'Muhammad uvaise', 'Sachu. T', 'Jithin Raj', 'fathima Muhammad Ali', 'JISHNU C', 'AnWiN George', 'Muhammad rizvan', 'Nila C B', 'FAYAS MUHAMMED', 'Muhammed shezil .T', 'Nihara Manoj K', 'Ayshath amna', 'farhan. pk', 'Abisha.M', 'Fathima.M.K', 'Aslam Vtr', 'sudharsan', 'Rena ayisha ', 'Diya shajeev', 'Siva Siva', 'Anita thomas', 'Haran dev. m', 'yo', 'Anjana Vinod', 'raeesa', 'FIDHA RUSHDA', 'sheza fasal', 'Musnad M', 'Fathima shifana pp', 'Sajim', 'Godwin  m. j', 'nazvin', 'Dhinya', 'Fathimma hiba. v', 'Bindhu Appukuttan', 'silna ks', 'Nihma ', 'Anupriya Anu', 'Ashik Babu', 'Dilshna', 'MUHAMMED RAMEES .K', 'Omana Sudhakaran', 'Niya Jithesh', 'Rayon Reji', 'Sheeja Prabha', 'fathima mufeedha.c', 'Ali Rasal', 'Fathima MM', 'Muhammed Rameez tk', 'lordson tomy', 'Theertha suresh', 'Fathima Shimya.k', 'shifna febin', 'Abani  Aakash', 'Athira anil', 'abinsha rafi', '‡¥∏‡µÅ‡¥´‡µà‡µΩ.ot', 'RAKHIL NATH R', 'Liz k Abraham ', 'Veena U Nair', 'Akshay mv', 'Midhuna.K.M', 'Jalwa cp', 'Ashi ziya', 'fidhaü¶ã', 'Pranav-k', 'Abdul nasar p.d', 'AKSHAY. S. NAIR', 'Muhammed Rishal c v', 'luke antony', 'sanjana Sunil', 'Ashikna Tirza', 'Misbaah Mubarak', 'ùöäùöìùöíùöúùöëùöä ùôº. ùöÅ', 'Anandu. R', 'abhijith om', 'Arjun Nair', 'shadiya sherin kp', 'Aryamol. k', 'GokulDas bs', 'Mohammed Haris', 'Sresa', 'avanthika ajith', 'Abhina kv', 'Ajiii', 'Ranganna', 'Navya vijayan.v', 'Arjun T. A', 'Alfiya abdul kareem', 'thajunnisa shameer', 'Muhammad nihal kavungal', 'sahalvp8', 'Dana Maria John', 'Anviyo Binoy', 'rasla', 'HAMTHA SHANAVAS', 'Mohammed safnad k', 'basheer p', 'Muhammad.k', 'Muhammad Sinan. m', 'Rini Kiran', 'Sana Sinnu', 'Haifa sharin m.t', 'Sree Chandana', 'Adil CP', 'Princy Thomas', 'Ratheesh Rameesh', 'shammas sayyid', 'Fathima Ashraf Aboobacker', 'muhammed midhaq ', 'Sabith Mc', 'Ashadinarajan Dinarajan', 'Aparna Ajay', 'vishnupradeep', 'Amritha ', 'Musthafa Pallikkal', 'Nandana MT', 'helna devasya', 'nafla m', 'Nima R', 'Alsiya.M.S', 'jeswin james', 'Farhana M A', 'shahana. M', 'Ayush Praveen op', 'fathima fidha T', 'Meera Kareem', 'Lekshmi.S', 'Anit mariya Benny', 'Jilna Johnson ', 'RADIL K', 'zakiya abdul ', 'Muhammed razi', 'fathimath swaliha', 'Binu Bahir', 'Fathima Rinsha.C', 'Keerthi.R', 'Alkka Mohanan ', 'Catherine George', 'Ananthika kishor', 'Ajith E. V', 'Muhammed shafi .m', 'Nandana. K.R', 'kishore. B', 'hisana sherin', 'Naval Krishna', 'Prajval Krishna.P.M', 'Abu Rayyan', 'gowri p ajish', 'Anamika. c', 'vachas', 'raiha', 'Shameema Jamsheer', 'Abhi S H', 'Muhammad irshad', 'Sajad A', 'Jona Joy', 'Anjana Rajesh ', 'Nivedya Raveendran', 'jinto', 'Muhammed Musthafa.k', 'Anakha C', 'ARUN M S', 'sreya m s', 'MUBASHIRA', 'SREEHARI.S 10D', 'Rithunand S B', 'Rahma', 'Mohammed Irshad ck', 'Nandana Dinesh', 'feba', 'Parvathi sreekumar', 'ADITHY√Å√ë', 'vishnuja J.S', 'muhammed rafi m', 'Muhammed Adil N', 'mohammed mishab', 'sachu joy', 'nehre', 'Maneesh k.s', 'Abdul  Fattah', 'Riza fathima k.k', 'sanusha. j', 'nikkiüçÉ', '◊ô◊ê◊û◊ü', 'Jithu Vk', 'Sulekha Kl', 'Ardra Pp', 'fathimarida', 'haya Fathima kp', 'Joseph K Babu', 'Mohammed Abdul hadi', 'Agra G Adiya', 'Chandra Rajesh M', 'Nayan Krishna T.K', 'salsan s m', 'prabha', 'Aierin', 'HAROON MUHAMMED N', 'shaba kp', 'Diya farook', 'Raja fathima pp', 'Daksh s anil', 'sanjay. k', 'Anurag pk', 'MUHAMMED HASHIR K', 'Malik Fff', 'Ithal  K Prakashan', 'Sanal Bhaskaran', 'shone shaju', 'Anamika Jayakumar', 'Ashfaq kv', 'sreenu vinayak', 'Archana v', 'AMINA S', 'nidhi usman', 'Fathimath Naja k', 'Fathima Hanna KV', 'Jinshad P Mohmd', 'Amjad  Roshan', 'Vishnu Sasikumar', 'vishnunath ER', 'Vinay Gupta', 'Siya Anna Sam', 'Ramitha T P', 'seena muhammed', 'Afsana MK', 'aneesa mol', 'Muhammed sabith k', 'Jilsa  Varkey', 'Ahammed Anshed.n', 'Alan santhosh', 'Jaseera Siraj', 'Basil Samuel Reji', 'Ansha mol', 'REEHAN', 'sumayya Hassain', 'Ahammed Shibin.P', 'Farhan. M', 'Dilna CH', 'Rajashree P', 'fathima nesrin', 'shehabin shihab p', 'Muhammed rameesh', 'Charuzz Charu', 'shefeekka fasna', 'Afla Nowf M.E', 'KEERTHANA S SAIJU', 'Ayishath Nahda', 'Prithijith.k', 'fidha mehrin', 'hasif muhammed', 'muhammed Thasneem', 'sidharth. k', 'Nissy Sera Skaria', 'Anson siby ', 'safna kv', 'Mohammed liban', 'Fidhanasrin', 'benedii', 'Diya. R', 'maleeha Fathima ', 'Yadhukul sumesh', 'AKHIL M M', 'Parthiv M N', 'Risana. s', 'vipinand kv', 'alencheriyan', 'Nithin S V', 'Bhamana Benny', 'yadhu krishna.A', 'Aswiny v', 'Shivajith.A', 'Archa I s', 'GOWRI NANDA MANOJ MANOJ', 'Bensira tp', 'Anand', 'Kesiya', 'GOURIKRISHNA P D', 'aravind vinod', 'dani Joseph', 'Ayush jikson', 'Fathima Ridha M', 'Adhikrishnan c.s', 'Gissna Mathew', 'Ahammed suhail. s', 'Rinsha jebin k', 'Nandana  T. P', 'MOHAMMED RAJAS', 'HASHFAKH', 'RISHWA', 'Anukrishnan', 'Sheeba Sreekumar', 'Rajithra', 'Manasir M', 'Vinayachandran KA', 'shifna. m', 'Dhanurved mb', 'DEVASURYA. S', 'Nisana Nasrin PM', 'Sharmila K', 'Sona Shaji', 'naja nasri', 'GXD MARTIN gaming', 'Tania fathima', 'Sahadiya ', 'Sreerag.k', 'Bala murali', 'vishnu ms', 'AbelMathew', 'Devanjana Dileep', 'ARJUN MR', 'adnan kalathil', 'Fathima shahaba cs', 'Mohammed Rashed', 'Dhanush K Prasad', 'Jishnu C', 'krishna priya TS', 'PRO GAMING', 'srishna', 'Nooh Usman']
            var allCourses = ["Class 4","Class 5","Class 6","Class 7","Class 7 Booster","Class 7 Foundation","Class 7 CBSE","USS Shakti","LSS Bhoom","Class 8","Class 8 Booster","Class 8 CBSE","Class 8 Foundation","Class 9","Class 9 Booster","Class 9 CBSE","Class 9 Foundation","SSLC Foundation","SSLC Booster","Class 10 CBSE","Plus One Sci Booster","Plus Two Sci Booster","Plus One Com Booster","Plus Two Com Booster","Plus One Hum Booster","Plus Two Hum Booster","Plus One JEE","Plus One NEET","Plus Two NEET","Plus Two JEE","JEE Repeater","NEET Repeater","NEET Test Series","Plus Two Com CUET","Plus Two Hum CUET","Plus Two Sci CUET"]

            if (isToastVisible) return; // Prevent showing a new toast while one is already visible
            isToastVisible = true;

            const toastContainer = document.getElementById('toast-container');
            toastContainer.style.display = 'flex';

            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomCount = Math.floor(Math.random() * (2355)) + 202;
            const courseName = allCourses[Math.floor(Math.random() * allCourses.length)];

            let message = `${randomName} and ${randomCount} others bought ${courseName} course in the last 24 hours...`;
            let formattedMessage = splitMessage(message, 40);

            const messageDiv = document.querySelector("#toast-container .toast .message");
            messageDiv.innerHTML = formattedMessage;

            const toast = document.querySelector("#toast-container .toast");
            const progressBar = document.querySelector("#toast-container .toast .toast-progress");

            // Reset the progress bar
            progressBar.style.animation = "none";
            setTimeout(() => {
                progressBar.style.animation = "progressBar 5s linear";
            }, 10);

            // Add fade-out animation to the toast
            toast.style.animation = "slideIn 0.5s ease, fadeOut 0.5s ease 5s";

            // Restart the toast after a 10-second delay
            toast.addEventListener('animationend', function (e) {
                if (e.animationName === 'fadeOut') {
                    toast.style.animation = ""; // Reset animation styles
                    progressBar.style.animation = "none"; // Reset progress bar animation

                    // Hide the toast for the delay period
                    toastContainer.style.display = 'none';
                    isToastVisible = false; // Allow new toast to be shown

                    // Show the next toast after a 10-second delay
                    // setTimeout(() => {
                    //     showToast(); // Restart the toast process
                    // }, 10000); // 10 seconds delay
                }
            });
        }


        fetchCourses();
        
        // Close confirmation modal button handler
        document.getElementById('close-confirmation').onclick = () => {
            document.getElementById('payment-confirmation').classList.add('hidden');
        };
        
        window.onclick = function(event) {
            if (event.target === document.getElementById('purchase-modal')) {
                document.getElementById('purchase-modal').classList.add('hidden');
            }
            if (event.target === document.getElementById('payment-confirmation')) {
                document.getElementById('payment-confirmation').classList.add('hidden');
            }
        }
        
    </script>
</body>
</html>
